natasha@natasha-VirtualBox:~$ sudo apt install nginx
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following packages were automatically installed and are no longer required:
  fonts-liberation2 fonts-opensymbol gir1.2-geocodeglib-1.0
  gir1.2-gst-plugins-base-1.0 gir1.2-gstreamer-1.0 gir1.2-gudev-1.0
  gir1.2-udisks-2.0 grilo-plugins-0.3-base gstreamer1.0-gtk3
  libboost-date-time1.65.1 libboost-filesystem1.65.1 libboost-iostreams1.65.1
  libboost-locale1.65.1 libcdr-0.1-1 libclucene-contribs1v5 libclucene-core1v5
  libcmis-0.5-5v5 libcolamd2 libdazzle-1.0-0 libe-book-0.1-1
  libedataserverui-1.2-2 libeot0 libepubgen-0.1-1 libetonyek-0.1-1
  libevent-2.1-6 libexiv2-14 libfreerdp-client2-2 libfreerdp2-2 libgc1c2
  libgee-0.8-2 libgexiv2-2 libgom-1.0-0 libgpgmepp6 libgpod-common libgpod4
  liblangtag-common liblangtag1 liblirc-client0 liblua5.3-0 libmediaart-2.0-0
  libmspub-0.1-1 libodfgen-0.1-1 libqqwing2v5 libraw16 librevenge-0.0-0
  libsgutils2-2 libssh-4 libsuitesparseconfig5 libvncclient1 libwinpr2-2
  libxapian30 libxmlsec1 libxmlsec1-nss linux-headers-5.0.0-37
  linux-headers-5.0.0-37-generic linux-image-5.0.0-37-generic
  linux-modules-5.0.0-37-generic linux-modules-extra-5.0.0-37-generic lp-solve
  media-player-info python3-mako python3-markupsafe syslinux syslinux-common
  syslinux-legacy usb-creator-common
Use 'sudo apt autoremove' to remove them.
The following additional packages will be installed:
  libnginx-mod-http-geoip libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream
  nginx-common nginx-core
Suggested packages:
  fcgiwrap nginx-doc
The following NEW packages will be installed:
  libnginx-mod-http-geoip libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream nginx
  nginx-common nginx-core
0 upgraded, 8 newly installed, 0 to remove and 42 not upgraded.
Need to get 598 kB of archives.
After this operation, 2 120 kB of additional disk space will be used.
Do you want to continue? [Y/n]
Get:1 http://ru.archive.ubuntu.com/ubuntu bionic-updates/main amd64 nginx-common                                                                              all 1.14.0-0ubuntu1.7 [37,4 kB]
Get:2 http://ru.archive.ubuntu.com/ubuntu bionic-updates/main amd64 libnginx-mod                                                                             -http-geoip amd64 1.14.0-0ubuntu1.7 [11,2 kB]
Get:3 http://ru.archive.ubuntu.com/ubuntu bionic-updates/main amd64 libnginx-mod                                                                             -http-image-filter amd64 1.14.0-0ubuntu1.7 [14,6 kB]
Get:4 http://ru.archive.ubuntu.com/ubuntu bionic-updates/main amd64 libnginx-mod                                                                             -http-xslt-filter amd64 1.14.0-0ubuntu1.7 [13,0 kB]
Get:5 http://ru.archive.ubuntu.com/ubuntu bionic-updates/main amd64 libnginx-mod                                                                             -mail amd64 1.14.0-0ubuntu1.7 [41,8 kB]
Get:6 http://ru.archive.ubuntu.com/ubuntu bionic-updates/main amd64 libnginx-mod                                                                             -stream amd64 1.14.0-0ubuntu1.7 [63,7 kB]
Get:7 http://ru.archive.ubuntu.com/ubuntu bionic-updates/main amd64 nginx-core a                                                                             md64 1.14.0-0ubuntu1.7 [413 kB]
Get:8 http://ru.archive.ubuntu.com/ubuntu bionic-updates/main amd64 nginx all 1.                                                                             14.0-0ubuntu1.7 [3 596 B]
Fetched 598 kB in 1s (1 177 kB/s)
Preconfiguring packages ...
Selecting previously unselected package nginx-common.
(Reading database ... 191991 files and directories currently installed.)
Preparing to unpack .../0-nginx-common_1.14.0-0ubuntu1.7_all.deb ...
Unpacking nginx-common (1.14.0-0ubuntu1.7) ...
Selecting previously unselected package libnginx-mod-http-geoip.
Preparing to unpack .../1-libnginx-mod-http-geoip_1.14.0-0ubuntu1.7_amd64.deb ..                                                                             .
Unpacking libnginx-mod-http-geoip (1.14.0-0ubuntu1.7) ...
Selecting previously unselected package libnginx-mod-http-image-filter.
Preparing to unpack .../2-libnginx-mod-http-image-filter_1.14.0-0ubuntu1.7_amd64                                                                             .deb ...
Unpacking libnginx-mod-http-image-filter (1.14.0-0ubuntu1.7) ...
Selecting previously unselected package libnginx-mod-http-xslt-filter.
Preparing to unpack .../3-libnginx-mod-http-xslt-filter_1.14.0-0ubuntu1.7_amd64.                                                                             deb ...
Unpacking libnginx-mod-http-xslt-filter (1.14.0-0ubuntu1.7) ...
Selecting previously unselected package libnginx-mod-mail.
Preparing to unpack .../4-libnginx-mod-mail_1.14.0-0ubuntu1.7_amd64.deb ...
Unpacking libnginx-mod-mail (1.14.0-0ubuntu1.7) ...
Selecting previously unselected package libnginx-mod-stream.
Preparing to unpack .../5-libnginx-mod-stream_1.14.0-0ubuntu1.7_amd64.deb ...
Unpacking libnginx-mod-stream (1.14.0-0ubuntu1.7) ...
Selecting previously unselected package nginx-core.
Preparing to unpack .../6-nginx-core_1.14.0-0ubuntu1.7_amd64.deb ...
Unpacking nginx-core (1.14.0-0ubuntu1.7) ...
Selecting previously unselected package nginx.
Preparing to unpack .../7-nginx_1.14.0-0ubuntu1.7_all.deb ...
Unpacking nginx (1.14.0-0ubuntu1.7) ...
Setting up nginx-common (1.14.0-0ubuntu1.7) ...
Created symlink /etc/systemd/system/multi-user.target.wants/nginx.service → /lib                                                                             /systemd/system/nginx.service.
Setting up libnginx-mod-http-image-filter (1.14.0-0ubuntu1.7) ...
Setting up libnginx-mod-mail (1.14.0-0ubuntu1.7) ...
Setting up libnginx-mod-http-xslt-filter (1.14.0-0ubuntu1.7) ...
Setting up libnginx-mod-http-geoip (1.14.0-0ubuntu1.7) ...
Setting up libnginx-mod-stream (1.14.0-0ubuntu1.7) ...
Setting up nginx-core (1.14.0-0ubuntu1.7) ...
Setting up nginx (1.14.0-0ubuntu1.7) ...
Processing triggers for man-db (2.8.3-2ubuntu0.1) ...
Processing triggers for ufw (0.36-0ubuntu0.18.04.1) ...
Processing triggers for ureadahead (0.100.0-21) ...
Processing triggers for systemd (237-3ubuntu10.33) ...

natasha@natasha-VirtualBox:~$ ps aux | grep ngi
gdm       1459  0.0  0.3 218632  7632 tty1     Sl   17:02   0:00 /usr/lib/ibus/ibus-engine-simple
root     10187  0.0  0.0 141112  1560 ?        Ss   17:08   0:00 nginx: master process /usr/sbin/nginx -g daemon on; master_process on;
www-data 10188  0.0  0.3 143788  6208 ?        S    17:08   0:00 nginx: worker process
natasha  10550  0.0  0.0  21532  1144 pts/0    S+   17:09   0:00 grep --color=auto ngi

natasha@natasha-VirtualBox:~$ openssl req -newkey rsa:2048 -nodes -keyout key.pem -x509 -days 365 -out certificate.pem
Can't load /home/natasha/.rnd into RNG
140492986286528:error:2406F079:random number generator:RAND_load_file:Cannot open file:../crypto/rand/randfile.c:88:Filename=/home/natasha/.rnd
Generating a RSA private key
.................................................+++++
.................................................+++++
writing new private key to 'key.pem'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:RU
State or Province Name (full name) [Some-State]:Karelia
Locality Name (eg, city) []:PTZ
Organization Name (eg, company) [Internet Widgits Pty Ltd]:Home
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:localhost
Email Address []:
natasha@natasha-VirtualBox:~$ ls
certificate.pem  Desktop  Documents  Downloads  git  homework  key.pem  Music  Pictures  Public  Templates  Videos

natasha@natasha-VirtualBox:~/www$ cat /etc/nginx/nginx.conf
user www-data;
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;

events {
        worker_connections 768;
        # multi_accept on;
}

http {

        ##
        # Basic Settings
        ##

        sendfile on;
        tcp_nopush on;
        tcp_nodelay on;
        keepalive_timeout 65;
        types_hash_max_size 2048;
        # server_tokens off;

        # server_names_hash_bucket_size 64;
        # server_name_in_redirect off;

        include /etc/nginx/mime.types;
        default_type application/octet-stream;

        ##
        # SSL Settings
        ##

        ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # Dropping SSLv3, ref: POODLE
        ssl_prefer_server_ciphers on;

        ##
        # Logging Settings
        ##

        access_log /var/log/nginx/access.log;
        error_log /var/log/nginx/error.log;

        ##
        # Gzip Settings
        ##

        gzip on;

        # gzip_vary on;
        # gzip_proxied any;
        # gzip_comp_level 6;
        # gzip_buffers 16 8k;
        # gzip_http_version 1.1;
        # gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

        ##
        # Virtual Host Configs
        ##

        server {
                listen 80;
                server_name vk.com;

                location / {
                        return 200 "vk.com";
                }
        }

        server {
                listen 80;
                server_name google.com;

                location / {
                        return 200 "google.com";
                }
        }

        server {
                listen 443 ssl;


                server_name localhost;

                ssl_certificate /home/natasha/certificate.pem;
                ssl_certificate_key /home/natasha/key.pem;

                location / {
                        root /home/natasha/www;
                        index index.html;
                }
        }
}

natasha@natasha-VirtualBox:~/www$ sudo /usr/sbin/nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
natasha@natasha-VirtualBox:~/www$ sudo /usr/sbin/nginx -s reload

natasha@natasha-VirtualBox:~/www$ sudo netstat -lnp | grep nginx
tcp        0      0 0.0.0.0:443             0.0.0.0:*               LISTEN      11192/nginx: master
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      11192/nginx: master

natasha@natasha-VirtualBox:~/www$ curl http://localhost -vH 'User: Natasha'
* Rebuilt URL to: http://localhost/
*   Trying 127.0.0.1...
* TCP_NODELAY set
* Connected to localhost (127.0.0.1) port 80 (#0)
> GET / HTTP/1.1
> Host: localhost
> User-Agent: curl/7.58.0
> Accept: */*
> User: Natasha
>
< HTTP/1.1 200 OK
< Server: nginx/1.14.0 (Ubuntu)
< Date: Sat, 01 Feb 2020 15:22:37 GMT
< Content-Type: application/octet-stream
< Content-Length: 12
< Connection: keep-alive
<
Hi, Natasha
* Connection #0 to host localhost left intact

natasha@natasha-VirtualBox:~/www$ curl http://localhost -v
* Rebuilt URL to: http://localhost/
*   Trying 127.0.0.1...
* TCP_NODELAY set
* Connected to localhost (127.0.0.1) port 80 (#0)
> GET / HTTP/1.1
> Host: localhost
> User-Agent: curl/7.58.0
> Accept: */*
>
< HTTP/1.1 404 Not Found
< Server: nginx/1.14.0 (Ubuntu)
< Date: Sat, 01 Feb 2020 15:23:36 GMT
< Content-Type: application/octet-stream
< Content-Length: 15
< Connection: keep-alive
<
Page not found
* Connection #0 to host localhost left intact
natasha@natasha-VirtualBox:~/www$

#конфиг

        server {
                listen 80;

                location / {
                        if ($http_user = "") {
                                return 404 "Page not found\n";
                        }

                        return 200 "Hi, $http_user\n";
                }
        }


#Задание 2. Самоподписанный сертификат  это специальный тип сертификата, подписанный его создателем. 
#С\п серт выпускается без участия стороннего удостоверяющего центра
natasha@natasha-VirtualBox:~$ openssl req -newkey rsa:2048 -nodes -keyout key.pem -x509 -days 365 -out certificate.pem
Can't load /home/natasha/.rnd into RNG
140492986286528:error:2406F079:random number generator:RAND_load_file:Cannot open file:../crypto/rand/randfile.c:88:Filename=/home/natasha/.rnd
Generating a RSA private key
.................................................+++++
.................................................+++++
writing new private key to 'key.pem'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:RU
State or Province Name (full name) [Some-State]:Karelia
Locality Name (eg, city) []:PTZ
Organization Name (eg, company) [Internet Widgits Pty Ltd]:Home
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:localhost
Email Address []:

        server {
                listen 443 ssl;


                server_name localhost;

                ssl_certificate /home/natasha/certificate.pem;
                ssl_certificate_key /home/natasha/key.pem;

                location / {
                        root /home/natasha/www;
                        index index.html;
                }
        }

#2.3. Ругается
#2.4.Почему бы не шифровать ассиметрично?  Потому что долго
#Зачем такая сложная схема для установления SSL соединения? - Чтобы удостовериться что сервер, тот, за кого себя выдает.
# - Нужно договориться о ключе для симметричного шифрования данных



